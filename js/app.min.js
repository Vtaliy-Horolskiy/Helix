'use strict';

window.onload = function () {

    //slideUp
    let slideUp = (target, duration = 500) => {

        target.style.transitionProperty = 'height, margin, padding';
        target.style.transitionDuration = duration + 'ms';
        target.style.boxSizing = 'border-box';
        target.style.height = target.offsetHeight + 'px';
        target.offsetHeight;
        target.style.overflow = 'hidden';
        target.style.height = 0;
        target.style.paddingTop = 0;
        target.style.paddingBottom = 0;
        target.style.marginTop = 0;
        target.style.marginBottom = 0;
        window.setTimeout(() => {
            target.style.display = 'none';
            target.style.removeProperty('height');
            target.style.removeProperty('padding-top');
            target.style.removeProperty('padding-bottom');
            target.style.removeProperty('margin-top');
            target.style.removeProperty('margin-bottom');
            target.style.removeProperty('overflow');
            target.style.removeProperty('transition-duration');
            target.style.removeProperty('transition-property');
            //alert("!");
        }, duration);
    };

    //slideDown
    let slideDown = (target, duration = 500) => {

        target.style.removeProperty('display');
        let display = window.getComputedStyle(target).display;
        if (display === 'none') display = 'block';
        target.style.display = display;
        let height = target.offsetHeight;
        target.style.overflow = 'hidden';
        target.style.height = 0;
        target.style.paddingTop = 0;
        target.style.paddingBottom = 0;
        target.style.marginTop = 0;
        target.style.marginBottom = 0;
        target.offsetHeight;
        target.style.boxSizing = 'border-box';
        target.style.transitionProperty = "height, margin, padding";
        target.style.transitionDuration = duration + 'ms';
        target.style.height = height + 'px';
        target.style.removeProperty('padding-top');
        target.style.removeProperty('padding-bottom');
        target.style.removeProperty('margin-top');
        target.style.removeProperty('margin-bottom');
        window.setTimeout(() => {
            target.style.removeProperty('height');
            target.style.removeProperty('overflow');
            target.style.removeProperty('transition-duration');
            target.style.removeProperty('transition-property');
        }, duration);
    };

    //Кнопка меню
    const menuBtn = document.querySelector('.menuTrigger');
    if (menuBtn) {
        menuBtn.addEventListener("click", () => {
            const menuBody = document.querySelector('.nav');
            const bodyContent = document.querySelector('html');
            if (!menuBtn.classList.contains('menuTrigger--close')) {
                menuBtn.classList.add('menuTrigger--close');
                menuBody.classList.add('nav--open');
                bodyContent.classList.add('fix-mobile');
            } else {
                menuBtn.classList.remove('menuTrigger--close');
                menuBody.classList.remove('nav--open');
                bodyContent.classList.remove('fix-mobile');
            }
        });
    }

    // Фиксация шапки при прокрутке
    const header = document.querySelector('.mainBox');
    const headerOffsetTop = header.offsetTop;

    window.addEventListener('scroll', function () {
        if (headerOffsetTop < window.pageYOffset) {
            header.classList.add('fixed');
        }
        else {
            header.classList.remove('fixed');
        }
    });

    // Слайдер преймуществ
    const swiperBenefits = new Swiper(".swiperBenefits", {
        slidesPerView: "auto",
        spaceBetween: 15,
        speed: 700,
        touchRatio: 1,
        autoHeight: true,
        pagination: {
            el: ".swiper-pagination",
            clickable: true,
            renderBullet: function (index, className) {
                const tabsName = ['Targeted Panels', 'Whole Exome Sequencing', 'lcWGS and Microarrays'];
                return '<span class="' + className + '">' + (tabsName[index]) + "</span>";
            },
        },
        breakpoints: {
            991.98: {
                touchRatio: 0,
            },
            577.98: {
                autoHeight: false,
            },
            374.98: {
                slidesPerView: 1,
                spaceBetween: 20,
            },
        },
    });


    // Вкладки
    const itemsList = document.querySelectorAll('.accordingSection__item');
    const itemContentList = document.querySelectorAll('.accordingSection__content');
    const imgList = document.querySelectorAll('.imgGroup__item');
    const speed = 400;

    if (itemsList.length > 0) {

        let According = (itemTitle, itemContent, dataId, imgList) => {
            itemContentList.forEach(item => {
                slideUp(item, speed);
            });
            itemTitle.parentNode.classList.add('accordingSection__item--current');
            setTimeout(slideDown, 500, itemContent, speed);
            imgList.forEach(item => { item.classList.remove('imgGroup__item--current'); });

            let imgItemCurrent = imgList[dataId];
            imgItemCurrent.classList.add('imgGroup__item--current');
            let imgItemHeight = imgItemCurrent.offsetHeight;
            imgItemCurrent.parentNode.style.height = imgItemHeight + 'px';
        };

        let ListArray = (itemsList) => {
            itemsList.forEach(item => {
                item.classList.remove('accordingSection__item--current');
            });
        };

        for (let i = 0; i < itemsList.length; i++) {
            let itemTitle, itemContent, dataId;
            let itemElement = itemsList[i];
            itemTitle = itemElement.querySelector('.accordingSection__title');
            itemContent = itemElement.querySelector('.accordingSection__content');
            dataId = itemTitle.parentNode.getAttribute('data-id');
            if (dataId == null) {
                dataId = 0;
            }

            itemTitle.addEventListener('click', () => {
                if (!itemTitle.parentNode.classList.contains('accordingSection__item--current')) {
                    ListArray(itemsList);
                    According(itemTitle, itemContent, dataId, imgList);
                }
            });

            if (itemTitle.parentNode.classList.contains('accordingSection__item--current')) {
                According(itemTitle, itemContent, dataId, imgList);
            }
        }
    }
};


